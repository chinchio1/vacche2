<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report IOFC - Analisi Allevamento</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .upload-section {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .upload-area {
            border: 2px dashed var(--secondary);
            padding: 40px 20px;
            border-radius: 8px;
            margin: 20px 0;
            background-color: #f8f9fa;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background-color: #e8f4fc;
        }
        
        button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-accent {
            background-color: var(--accent);
        }
        
        .btn-accent:hover {
            background-color: #c0392b;
        }
        
        .report-section {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .farm-report {
            margin-bottom: 40px;
            page-break-inside: avoid;
        }
        
        .farm-name {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .comparison-table th {
            background-color: var(--light);
            font-weight: bold;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .section-title {
            background-color: var(--dark);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            margin: 20px 0 10px;
        }
        
        .kpi-highlight {
            font-weight: bold;
            color: var(--accent);
        }
        
        .positive {
            color: var(--success);
        }
        
        .negative {
            color: var(--accent);
        }
        
        .footer-note {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            text-align: center;
            font-size: 14px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            display: none;
        }
        
        .alert-success {
            background-color: #d5f4e6;
            color: #27ae60;
            border: 1px solid #27ae60;
        }
        
        .alert-error {
            background-color: #fadbd8;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        @media print {
            button, .upload-section {
                display: none;
            }
            
            .report-section {
                display: block !important;
                box-shadow: none;
                padding: 0;
            }
            
            body {
                background-color: white;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Report IOFC - Analisi Allevamento</h1>
            <p>Genera report comparativi sui dati della tua azienda agricola</p>
        </header>
        
        <div class="upload-section">
            <h2>Carica i dati dell'allevamento</h2>
            <p>Seleziona un file Excel con i dati o utilizza i dati di esempio per generare il report</p>
            
            <div class="upload-area">
                <p>Trascina qui il file Excel o clicca per selezionare</p>
                <input type="file" id="fileInput" accept=".xlsx, .xls" style="display: none;">
                <button onclick="document.getElementById('fileInput').click()">Seleziona File</button>
                <p id="fileName" style="margin-top: 10px; font-style: italic;"></p>
            </div>
            
            <div id="alertMessage" class="alert"></div>
            
            <button onclick="processData()">Genera Report</button>
            <button onclick="loadSampleData()" class="btn-accent">Carica Dati di Esempio</button>
            <button onclick="printReport()" id="printBtn" style="display: none;">Stampa Report</button>
        </div>
        
        <div id="reportSection" class="report-section">
            <!-- Il report verrà generato qui dinamicamente -->
        </div>
    </div>

    <script>
        // Dati di esempio basati sul PDF fornito
        const sampleData = {
            farms: [
                {
                    name: "ANCELLOTTI",
                    code: "IT1046",
                    periods: [
                        {
                            name: "ago-25",
                            herd: {
                                cowsPresent: 334,
                                cowsInMilk: 302,
                                cowCalvings: 25,
                                heiferCalvings: 14,
                                cowsReformed: 8,
                                heifersPresent: 239
                            },
                            milk: {
                                totalProduced: 354823,
                                productionPerCowPerDay: 37.9,
                                fat: 4.27,
                                protein: 3.65,
                                urea: 180,
                                somaticCells: 222,
                                bacterialLoad: 10,
                                milkPrice: 107.46, // €cent/tl
                                totalValue: 381294 // €
                            },
                            feeding: {
                                concentratesPerLiter: 0.51,
                                conversionIndex: 1.37,
                                totalConcentrates: 180.22, // ton
                                concentrateCostPerTonne: 476, // €/ton
                                otherFeedingCosts: 20918, // €
                                totalFeedingCosts: 106712, // €
                                feedingCostPerLiter: 30.07, // €cent/tl
                                totalDryMatter: 259.30 // ton
                            },
                            margins: {
                                marginPerLiter: 77.39, // €cent/tl
                                marginPerCow: 822, // €
                                marginPerHerd: 440 // € (probabilmente migliaia)
                            }
                        },
                        {
                            name: "ago-24",
                            herd: {
                                cowsPresent: 336,
                                cowsInMilk: 302,
                                cowCalvings: 18,
                                heiferCalvings: 7,
                                cowsReformed: 25,
                                heifersPresent: 176
                            },
                            milk: {
                                totalProduced: 361373,
                                productionPerCowPerDay: 38.6,
                                fat: 4.08,
                                protein: 3.58,
                                urea: 190,
                                somaticCells: 188,
                                bacterialLoad: 12,
                                milkPrice: 89.84, // €cent/tl
                                totalValue: 324658 // €
                            },
                            feeding: {
                                concentratesPerLiter: 0.44,
                                conversionIndex: 0,
                                totalConcentrates: 159.00, // ton
                                concentrateCostPerTonne: 512, // €/ton
                                otherFeedingCosts: 35270, // €
                                totalFeedingCosts: 105232, // €
                                feedingCostPerLiter: 29.12, // €cent/tl
                                totalDryMatter: 0 // non disponibile
                            },
                            margins: {
                                marginPerLiter: 60.72, // €cent/tl
                                marginPerCow: 653, // €
                                marginPerHerd: 394 // € (probabilmente migliaia)
                            }
                        }
                    ]
                },
                {
                    name: "FUXYFARM",
                    code: "",
                    periods: [
                        {
                            name: "ago-25",
                            herd: {
                                cowsPresent: 332,
                                cowsInMilk: 292,
                                cowCalvings: 0, // Non specificato separatamente
                                heiferCalvings: 0, // Non specificato separatamente
                                totalCalvings: "100%", // Indicato come percentuale
                                cowsReformed: "26%", // Indicato come percentuale
                                heifersPresent: 210,
                                cowHeiferRatio: "61%"
                            },
                            milk: {
                                productionPerCowPerYear: 117.89, // hl/anno
                                fat: 4.31,
                                protein: 3.77,
                                urea: 213,
                                somaticCells: 165,
                                bacterialLoad: 9,
                                milkPrice: 99.88, // €cent/tl
                                totalValue: 9820 // € (probabilmente migliaia)
                            },
                            feeding: {
                                concentratesPerLiter: 0.53,
                                conversionIndex: 1.33,
                                totalConcentrates: 170.96, // ton
                                concentrateCostPerTonne: 458, // €/ton
                                otherFeedingCosts: 558, // €
                                totalFeedingCosts: 2915, // €
                                feedingCostPerLiter: 29.68, // €cent/tl
                                totalDryMatter: 245 // ton
                            },
                            margins: {
                                marginPerLiter: 70.20, // €cent/tl
                                marginPerCow: 8287, // €
                                marginPerHerd: 4593 // €
                            }
                        }
                    ]
                }
            ]
        };

        // Gestione del caricamento file
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'Nessun file selezionato';
            document.getElementById('fileName').textContent = fileName;
        });

        // Funzione per processare i dati (qui semplificata)
        function processData() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                showAlert('Per favore seleziona un file Excel prima di generare il report.', 'error');
                return;
            }
            
            // In una implementazione reale, qui si processerebbe il file Excel
            // Per questa demo, usiamo i dati di esempio
            loadSampleData();
        }

        // Carica i dati di esempio
        function loadSampleData() {
            generateReport(sampleData);
            showAlert('Report generato con successo dai dati di esempio!', 'success');
            document.getElementById('printBtn').style.display = 'inline-block';
        }

        // Genera il report HTML
        function generateReport(data) {
            const reportSection = document.getElementById('reportSection');
            reportSection.innerHTML = '';
            
            data.farms.forEach(farm => {
                const farmReport = document.createElement('div');
                farmReport.className = 'farm-report';
                
                // Intestazione azienda
                const farmHeader = document.createElement('div');
                farmHeader.className = 'farm-name';
                farmHeader.innerHTML = `<h2>${farm.name}</h2>${farm.code ? `<p>${farm.code}</p>` : ''}`;
                farmReport.appendChild(farmHeader);
                
                // Sezione MANDRIA
                farmReport.appendChild(createSection('MANDRIA', createHerdTable(farm)));
                
                // Sezione LATTE
                farmReport.appendChild(createSection('LATTE', createMilkTable(farm)));
                
                // Sezione ALIMENTAZIONE
                farmReport.appendChild(createSection('ALIMENTAZIONE', createFeedingTable(farm)));
                
                // Sezione MARGINI - IOFC
                farmReport.appendChild(createSection('MARGINI - IOFC', createMarginsTable(farm)));
                
                reportSection.appendChild(farmReport);
            });
            
            // Aggiungi nota a piè di pagina
            const footerNote = document.createElement('div');
            footerNote.className = 'footer-note';
            footerNote.innerHTML = `
                Il nostro obiettivo è di produrre report accurati. La società declina ogni responsabilità 
                per eventuali errori o inesattezze nei report prodotti derivanti dalla scarsa qualità 
                e accuratezza delle informazioni fornite.
            `;
            reportSection.appendChild(footerNote);
            
            // Mostra la sezione del report
            reportSection.style.display = 'block';
        }

        // Crea una sezione del report
        function createSection(title, content) {
            const section = document.createElement('div');
            section.innerHTML = `
                <h3 class="section-title">${title}</h3>
                ${content}
            `;
            return section;
        }

        // Crea la tabella per la sezione MANDRIA
        function createHerdTable(farm) {
            let tableHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>MANDRIA</th>
            `;
            
            // Intestazioni colonne (periodi)
            farm.periods.forEach(period => {
                tableHTML += `<th>${period.name}</th>`;
            });
            
            tableHTML += `</tr></thead><tbody>`;
            
            // Righe dei dati
            const herdFields = [
                { label: 'Vacche presenti', key: 'cowsPresent' },
                { label: 'Vacche in latte', key: 'cowsInMilk' },
                { label: 'N° parti vacche', key: 'cowCalvings' },
                { label: 'N° parti manze', key: 'heiferCalvings' },
                { label: 'N° vacche riformate', key: 'cowsReformed' },
                { label: 'Manze presenti', key: 'heifersPresent' }
            ];
            
            // Per FUXYFARM, campi speciali
            if (farm.name === "FUXYFARM") {
                herdFields.push(
                    { label: 'N° parti vacche + manze', key: 'totalCalvings' },
                    { label: 'N° vacche riformate', key: 'cowsReformed' },
                    { label: 'Rapporto vacche/manze', key: 'cowHeiferRatio' }
                );
            }
            
            herdFields.forEach(field => {
                tableHTML += `<tr><td>${field.label}</td>`;
                
                farm.periods.forEach(period => {
                    const value = period.herd[field.key];
                    tableHTML += `<td>${value !== undefined ? value : '-'}</td>`;
                });
                
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody></table>`;
            return tableHTML;
        }

        // Crea la tabella per la sezione LATTE
        function createMilkTable(farm) {
            let tableHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>LATTE</th>
            `;
            
            // Intestazioni colonne (periodi)
            farm.periods.forEach(period => {
                tableHTML += `<th>${period.name}</th>`;
            });
            
            tableHTML += `</tr></thead><tbody>`;
            
            // Righe dei dati
            const milkFields = [
                { label: 'Totale latte prodotto', key: 'totalProduced', unit: '(litri)' },
                { label: 'Produzione latte capo/giorno', key: 'productionPerCowPerDay', unit: '(litri)' },
                { label: 'Grasso', key: 'fat', unit: '(%)' },
                { label: 'Proteine', key: 'protein', unit: '(%)' },
                { label: 'Urea', key: 'urea', unit: '(mg/Lt)' },
                { label: 'Cellule somatiche', key: 'somaticCells', unit: '(x1000)' },
                { label: 'Carica batterica', key: 'bacterialLoad', unit: '(x1000)' },
                { label: 'Prezzo del latte', key: 'milkPrice', unit: '(€cent/tl)' },
                { label: 'Valore totale del latte', key: 'totalValue', unit: '(€)' }
            ];
            
            // Per FUXYFARM, campo speciale
            if (farm.name === "FUXYFARM") {
                milkFields.splice(1, 1, { label: 'Produzione per vacca', key: 'productionPerCowPerYear', unit: '(hl/anno)' });
            }
            
            milkFields.forEach(field => {
                tableHTML += `<tr><td>${field.label} ${field.unit}</td>`;
                
                farm.periods.forEach(period => {
                    const value = period.milk[field.key];
                    if (value !== undefined) {
                        // Aggiungi formattazione speciale per alcuni valori
                        if (field.key === 'milkPrice' || field.key === 'feedingCostPerLiter' || field.key === 'marginPerLiter') {
                            tableHTML += `<td class="kpi-highlight">${value}</td>`;
                        } else if (field.key === 'totalValue') {
                            tableHTML += `<td>${formatNumber(value)}</td>`;
                        } else {
                            tableHTML += `<td>${value}</td>`;
                        }
                    } else {
                        tableHTML += `<td>-</td>`;
                    }
                });
                
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody></table>`;
            return tableHTML;
        }

        // Crea la tabella per la sezione ALIMENTAZIONE
        function createFeedingTable(farm) {
            let tableHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ALIMENTAZIONE</th>
            `;
            
            // Intestazioni colonne (periodi)
            farm.periods.forEach(period => {
                tableHTML += `<th>${period.name}</th>`;
            });
            
            tableHTML += `</tr></thead><tbody>`;
            
            // Righe dei dati
            const feedingFields = [
                { label: 'Concentrati per litro', key: 'concentratesPerLiter', unit: '(kg)' },
                { label: 'Indice di conversione', key: 'conversionIndex', unit: '(lt/kgSS)' },
                { label: 'Totale concentrati', key: 'totalConcentrates', unit: '(ton)' },
                { label: 'Costo concentrati per tonnellata', key: 'concentrateCostPerTonne', unit: '(€/ton)' },
                { label: 'Altri costi di alimentazione', key: 'otherFeedingCosts', unit: '(€)' },
                { label: 'Costo totali alimentazione', key: 'totalFeedingCosts', unit: '(€)' },
                { label: 'Costo alimentare per litro latte', key: 'feedingCostPerLiter', unit: '(€cent/tl)' },
                { label: 'Totale sostanza secca', key: 'totalDryMatter', unit: '(ton)' }
            ];
            
            feedingFields.forEach(field => {
                tableHTML += `<tr><td>${field.label} ${field.unit}</td>`;
                
                farm.periods.forEach(period => {
                    const value = period.feeding[field.key];
                    if (value !== undefined) {
                        if (field.key === 'feedingCostPerLiter') {
                            tableHTML += `<td class="kpi-highlight">${value}</td>`;
                        } else if (field.unit === '(€)') {
                            tableHTML += `<td>${formatNumber(value)}</td>`;
                        } else {
                            tableHTML += `<td>${value}</td>`;
                        }
                    } else {
                        tableHTML += `<td>-</td>`;
                    }
                });
                
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody></table>`;
            return tableHTML;
        }

        // Crea la tabella per la sezione MARGINI - IOFC
        function createMarginsTable(farm) {
            let tableHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>MARGINI - IOFC</th>
            `;
            
            // Intestazioni colonne (periodi)
            farm.periods.forEach(period => {
                tableHTML += `<th>${period.name}</th>`;
            });
            
            tableHTML += `</tr></thead><tbody>`;
            
            // Righe dei dati
            const marginsFields = [
                { label: 'Margine sul costo alimentare per litro', key: 'marginPerLiter', unit: '(€cent/tl)' },
                { label: 'Margine sul costo alimentare per vacca', key: 'marginPerCow', unit: '(€)' },
                { label: 'Margine sul costo alimentare per mandria', key: 'marginPerHerd', unit: '(€)' }
            ];
            
            marginsFields.forEach(field => {
                tableHTML += `<tr><td>${field.label} ${field.unit}</td>`;
                
                farm.periods.forEach(period => {
                    const value = period.margins[field.key];
                    if (value !== undefined) {
                        if (field.key === 'marginPerLiter') {
                            tableHTML += `<td class="kpi-highlight positive">${value}</td>`;
                        } else if (field.unit === '(€)') {
                            tableHTML += `<td class="positive">${formatNumber(value)}</td>`;
                        } else {
                            tableHTML += `<td class="positive">${value}</td>`;
                        }
                    } else {
                        tableHTML += `<td>-</td>`;
                    }
                });
                
                tableHTML += `</tr>`;
            });
            
            tableHTML += `</tbody></table>`;
            return tableHTML;
        }

        // Formatta i numeri con separatore delle migliaia
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Mostra messaggi di avviso
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        // Stampa il report
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
